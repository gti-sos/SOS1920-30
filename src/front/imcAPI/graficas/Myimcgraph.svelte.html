<script>
    import {pop} from "svelte-spa-router";
    import Button from "sveltestrap/src/Button.svelte";
    async function loadGraph(){
        let paises2019 = [];
        let paises2020 = [];
        let guardado_de_datos = [];
        const Datos = await fetch("/api/v3/indice_de_masa_corporal");
        guardado_de_datos = await Datos.json();
        guardado_de_datos.filter(data =>  data.year == 2019).forEach((data) => {
            let paises = { 
		        'name': data.place,
                'value': parseFloat(data.indice_de_masa_corporal)
    	};
            paises2019.push(paises);
        });     
        guardado_de_datos.filter(data => data.year == 2020).forEach((data) => {
            let paises = { 
		        'name': data.place,
		        'value': parseFloat(data.indice_de_masa_corporal)
    	};
            paises2020.push(paises);
        });
        console.log(paises2019);
        console.log(paises2020);
        Highcharts.chart('container', {

    chart: {
        type: 'packedbubble',
        height: '100%'
    },
    title: {
        text: '  IMC por paises en 2019/2020'
    },
    tooltip: {
        useHTML: true,
        pointFormat: '<b>{point.name}:</b> {point.value} = imc' 
    },
    plotOptions: {
        packedbubble: {
            minSize: '30%',
            maxSize: '120%',
            zMin: 0,
            zMax: 1000,
            layoutAlgorithm: {
                splitSeries: false,
                gravitationalConstant: 0.02
            },
            iLabels: {
                enabled: true,
                format: '{point.name}',
                filter: {
                    property: 'y',
                    operator: '>',
                    value: 250
                },
                style: {
                    color: 'black',
                    textOutline: 'none',
                    fontWeight: 'normal'
                }
            }
        }
    },
            series:  [{
        name: '2019',
        data: paises2019
    },
    {
        name: '2020',
        data: paises2020
    }]
});
    }
</script>
<svelte:head>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"on:load="{loadGraph}"></script>

</svelte:head>
<main>
<figure class="highcharts-figure">
    <div id="container"></div>
    <p >
        Aqui mostramos una grafica en la que podemos observar el imc(indice de masa corporal) que tienen ciertos paises del continente europeo
        En negro veríamos los paises en el año 2020 y en azul el 2019
 
    </p>
</figure>
<Button outline color="secondary" on:click="{pop}"> <i class="fas fa-arrow-circle-left"></i> Atrás </Button>
</main>
